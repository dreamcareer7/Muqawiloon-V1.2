

  <div class="card card-middle">

    <div class="card__section card__section--padded">
      <div class="card__header">
        <div class="card__title">
          <h4 class="card__title"><%= inline_svg("icons/#{ I18n.with_locale(:en){ @category.name.downcase } }.svg", class: "icon icon--small icon--dark")%> <%= t("post_project.service_type", category: @category.name.downcase.singularize) %></h4>
        </div>
      </div>
      <fieldset class="fieldset">
        
          <div class="grid__col--xs-12 grid__col--md-12">
            <div class="field">
              <div class="field__input-wrapper">
                <%= inline_svg("icons/dropdown.svg", class: "icon field__add-on field__add-on--right field__add-on--clickthrough") %>
                <%= f.input :project_services, collection: @project.category.cached_subcategories, selected: @project.sub_categories.present? ? @project.sub_categories.first.id : '', input_html: { class: "field__input field__input--right-add-on js-selected-subcat" }, label: false, required: true, include_blank: true %>
              </div>
            </div>
          </div>
        
      </fieldset>
    </div>

    <% @category.cached_subcategories.each do |sub_category| %>
      <div class="card__section card__section--padded js-select-services <%= 'u-hide' unless @project.sub_categories.include?(sub_category) %>" data-sub-cat="<%= sub_category.id %>">
        <div class="card__header">
          <div class="card__title">
            <h4 class="card__title"><%= sub_category.name.singularize %> <%= t("words.services") %></h4>
          </div>
        </div>
        <fieldset class="fieldset">
          
            <div class="grid__col--xs-12 grid__col--md-12">
              <div class="field">
                <label class="field__label">* <%= t("post_project.project_services") %></label>
                <%= f.association :services, collection: sub_category.services.cached_visible, selected: @project.services.pluck(:id), input_html: { multiple: true, style: "width:100%", class: "js-selected-services" }, wrapper: :select2, label: false %>
              </div>
            </div>
         </fieldset>
      </div>
    <% end %>

  </div>

  

<% if @project.present? %>
  <%= content_tag :span, '', class: "js-project-subs", data: { sub_cats: @project.sub_categories.map{ |sub_cat| I18n.with_locale(:en){ sub_cat.name.gsub(" ", "").downcase } } } %>
<% end %>





  <script>
    var selectedSubCat = '';

    $('.js-selected-services').on('change', function() {
      if($(this).val() && $(this).val().length) {
        $('.js-submit').prop('disabled', false)
      }
    });

    $('.js-submit').prop('disabled', true)
    
    $('.js-selected-subcat').on('change', function() {
      selectedSubCat = parseInt($(this).val());
      console.log(selectedSubCat)
      $.each($('.js-select-services'), function() {
        if ($(this).data('sub-cat') === selectedSubCat) {
          $(this).removeClass('u-hide')
        } else {
          $(this).addClass('u-hide');
          $(this).find('select').val('').change();
        }
      })
    });
  </script>
